!function(t,e){var o=window.__UTILS.getItemById;t.use(e);var n=new e.Store({state:{greeting:{id:0,scopeType:"",scopeItems:[],scopeNumber:0,tinyTree:[],content:"",attachments:[],daypartingRules:[]},staffAndDepartment:[],trenchs:[],contentLibrary:{categories:[],data:[]},serviceInfo:{},selectedCountMap:{},treeRequestPromiseMap:{}},mutations:{SET_GREETING:function(t,e){t.greeting=Object.assign({},t.greeting,e)},SET_GREETING_SCOPE_TYPE:function(t,e){t.greeting.scopeType=e},SET_GREETING_SCOPE_ITEMS:function(t,e){t.greeting.scopeItems=e},SET_GREETING_SCOPE_NUMBER:function(t,e){t.greeting.scopeNumber=e},SET_GREETING_TINY_TREE:function(t,e){t.greeting.tinyTree=e},SET_STAFF_AND_DEPARTMENT:function(t,e){t.staffAndDepartment=e},SET_TRENCHS:function(t,e){t.trenchs=e},SET_GREETING_DAYPARTING_RULES:function(t,e){t.greeting.daypartingRules=e},SET_GREETING_CONTENT:function(t,e){t.greeting.content=e},SET_GREETING_ATTACHMENTS:function(t,e){t.greeting.attachments=e},SET_CONTENT_LIBRARY:function(t,e){t.contentLibrary=e},SET_SERVICE_INFO:function(t,e){t.serviceInfo=e},SET_DEPARTMENT_CHILDREN:function(t,e){var n=e.id,i=e.children;if(!n)return t.staffAndDepartment=i;var r=[].concat(t.staffAndDepartment),a=o(r,n);a&&(a.children=i,t.staffAndDepartment=r)},SET_SELECTED_COUNT_MAP:function(t,e){var n=e.key,i=e.value,r=Object.assign({},t.selectedCountMap);r[n]=i,t.selectedCountMap=r},SET_TREE_REQUEST_PROMISE:function(t,e){var n=e.id||"__ROOT",i=e.promise,r=Object.assign({},t.treeRequestPromiseMap);i?r[n]=i:delete r[n],t.treeRequestPromiseMap=r}},actions:{GET_STAFF_AND_DEPARTMENT:function(e,t){return(t=void 0===t||t)&&e.state.staffAndDepartment.length?Promise.resolve():axios.get(window.__MOCK_API.getStaffAndDepartment).then(function(t){t.data.success&&e.commit("SET_STAFF_AND_DEPARTMENT",t.data.data)})},GET_TRENCHS:function(e,t){return(t=void 0===t||t)&&e.state.trenchs.length?Promise.resolve():axios.get(window.__MOCK_API.getTrenchs).then(function(t){t.data.success&&e.commit("SET_TRENCHS",t.data.data)})},GET_CONTENT_LIBRARY:function(e,t){return(t=void 0===t||t)&&e.state.contentLibrary.categories.length&&e.state.contentLibrary.data.length?Promise.resolve():axios.get(window.__MOCK_API.getContentLibrary).then(function(t){t.data.success&&e.commit("SET_CONTENT_LIBRARY",t.data.data)})},GET_SERVICE_INFO:function(e,t){return(t=void 0===t||t)&&e.state.serviceInfo.cover?Promise.resolve():axios.get(window.__MOCK_API.getServiceInfo).then(function(t){t.data.success&&e.commit("SET_SERVICE_INFO",t.data.data)})},GET_DEPARTMENT_CHILDREN_BY_ID:function(e,n,t){t=void 0===t||t;var i=o(e.state.staffAndDepartment,n);if(t&&i&&i.length)return Promise.resolve();var r=e.state.treeRequestPromiseMap[n||"__ROOT"];if(r)return r;var a=axios.get(window.__MOCK_API.getDepartmentChildrenById,{params:{id:n}}).then(function(t){t.data.success&&(e.commit("SET_DEPARTMENT_CHILDREN",{id:n,children:t.data.data}),e.commit("SET_TREE_REQUEST_PROMISE",{id:n,promise:null}))});return e.commit("SET_TREE_REQUEST_PROMISE",{id:n,promise:a}),a},GET_SELECTED_COUNT_MAP:function(i,t){var r=t.map(function(t){return t.id}).sort().join(","),e=i.state.selectedCountMap[r];if(e)return e instanceof Promise?e:Promise.resolve();var n=new Promise(function(e){function n(t){i.commit("SET_SELECTED_COUNT_MAP",{key:r,value:t}),e()}axios.post(window.__MOCK_API.getStaffNumberByItems,t.map(function(t){return{id:t.id,type:t.type}})).then(function(t){if(200!==t.status||!t.data.success)return n(null);n(t.data.data)})});return i.commit("SET_SELECTED_COUNT_MAP",{key:r,value:n}),n},GET_TREE_BY_TINY_TREE:function(i){var r=i.state.greeting.tinyTree;if(!r||!r.length)return Promise.resolve();var a=0;return function e(t){t.forEach(function(t){2===t.t&&(a++,t.c&&t.c.length&&e(t.c))})}(r),new Promise(function(n){function t(){!function e(t){t.forEach(function(t){2===t.t&&i.dispatch("GET_DEPARTMENT_CHILDREN_BY_ID",t.i).then(function(){if(!--a)return n();t.c&&t.c.length&&e(t.c)})})}(r)}if(i.state.staffAndDepartment.length)return t();var e=i.state.treeRequestPromiseMap.__ROOT;if(e)return e.then(t);i.dispatch("GET_DEPARTMENT_CHILDREN_BY_ID").then(t)})}}});Object.defineProperty(window,"__VUEX_STORE",{get:function(){return n}})}(Vue,Vuex);