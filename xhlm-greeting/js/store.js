!function(e,t){var a=window.__UTILS.getItemById;e.use(t);var n=new t.Store({state:{greeting:{id:0,scopeType:"",scopeItems:[],scopeNumber:0,tinyTree:[],content:"",attachments:[],daypartingRules:[]},staffAndDepartment:[],trenchs:[],serviceInfo:{},selectedCountMap:{},treeRequestPromiseMap:{}},mutations:{SET_GREETING:function(e,t){e.greeting=Object.assign({},e.greeting,t)},SET_GREETING_SCOPE_TYPE:function(e,t){e.greeting.scopeType=t},SET_GREETING_SCOPE_ITEMS:function(e,t){e.greeting.scopeItems=t},SET_GREETING_SCOPE_NUMBER:function(e,t){e.greeting.scopeNumber=t},SET_GREETING_TINY_TREE:function(e,t){e.greeting.tinyTree=t},SET_STAFF_AND_DEPARTMENT:function(e,t){e.staffAndDepartment=t},SET_TRENCHS:function(e,t){e.trenchs=t},SET_GREETING_DAYPARTING_RULES:function(e,t){e.greeting.daypartingRules=t},SET_GREETING_CONTENT:function(e,t){e.greeting.content=t},SET_GREETING_ATTACHMENTS:function(e,t){e.greeting.attachments=t},SET_SERVICE_INFO:function(e,t){e.serviceInfo=t},SET_DEPARTMENT_CHILDREN:function(e,t){var n=t.id,i=t.children;if(!n)return e.staffAndDepartment=i;var r=[].concat(e.staffAndDepartment),E=a(r,n);E&&(E.children=i,e.staffAndDepartment=r)},SET_SELECTED_COUNT_MAP:function(e,t){var n=t.key,i=t.value,r=Object.assign({},e.selectedCountMap);r[n]=i,e.selectedCountMap=r},SET_TREE_REQUEST_PROMISE:function(e,t){var n=t.id||"__ROOT",i=t.promise,r=Object.assign({},e.treeRequestPromiseMap);i?r[n]=i:delete r[n],e.treeRequestPromiseMap=r}},actions:{GET_STAFF_AND_DEPARTMENT:function(t,e){return(e=void 0===e||e)&&t.state.staffAndDepartment.length?Promise.resolve():axios.get(window.__API.getStaffAndDepartment).then(function(e){e.data.success&&t.commit("SET_STAFF_AND_DEPARTMENT",e.data.data)})},GET_TRENCHS:function(t,e){return(e=void 0===e||e)&&t.state.trenchs.length?Promise.resolve():axios.get(window.__API.getTrenchs).then(function(e){e.data.success&&t.commit("SET_TRENCHS",e.data.data)})},GET_SERVICE_INFO:function(t,e){return(e=void 0===e||e)&&t.state.serviceInfo.cover?Promise.resolve():axios.get(window.__API.getServiceInfo).then(function(e){e.data.success&&t.commit("SET_SERVICE_INFO",e.data.data)})},GET_DEPARTMENT_CHILDREN_BY_ID:function(t,n,e){e=void 0===e||e;var i=a(t.state.staffAndDepartment,n);if(e&&i&&i.length)return Promise.resolve();var r=t.state.treeRequestPromiseMap[n||"__ROOT"];if(r)return r;var E=axios.get(window.__API.getDepartmentChildrenById,{params:{id:n}}).then(function(e){e.data.success&&(t.commit("SET_DEPARTMENT_CHILDREN",{id:n,children:e.data.data}),t.commit("SET_TREE_REQUEST_PROMISE",{id:n,promise:null}))});return t.commit("SET_TREE_REQUEST_PROMISE",{id:n,promise:E}),E},GET_SELECTED_COUNT_MAP:function(i,e){var r=e.map(function(e){return e.id}).sort().join(","),t=i.state.selectedCountMap[r];if(t)return t instanceof Promise?t:Promise.resolve();var n=new Promise(function(t){function n(e){i.commit("SET_SELECTED_COUNT_MAP",{key:r,value:e}),t()}axios.post(window.__API.getStaffNumberByItems,e.map(function(e){return{id:e.id,type:e.type}})).then(function(e){if(200!==e.status||!e.data.success)return n(null);n(e.data.data)})});return i.commit("SET_SELECTED_COUNT_MAP",{key:r,value:n}),n},GET_TREE_BY_TINY_TREE:function(i){var r=i.state.greeting.tinyTree;if(!r||!r.length)return Promise.resolve();var E=0;return function t(e){e.forEach(function(e){2===e.t&&(E++,e.c&&e.c.length&&t(e.c))})}(r),new Promise(function(n){function e(){!function t(e){e.forEach(function(e){2===e.t&&i.dispatch("GET_DEPARTMENT_CHILDREN_BY_ID",e.i).then(function(){if(!--E)return n();e.c&&e.c.length&&t(e.c)})})}(r)}if(i.state.staffAndDepartment.length)return e();var t=i.state.treeRequestPromiseMap.__ROOT;if(t)return t.then(e);i.dispatch("GET_DEPARTMENT_CHILDREN_BY_ID").then(e)})}}});Object.defineProperty(window,"__VUEX_STORE",{get:function(){return n}})}(Vue,Vuex);